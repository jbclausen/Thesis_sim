import numpy as np
import matplotlib.pyplot as plt 
from scipy.optimize import curve_fit

def func(x, a, b, c):
    return a * np.exp(-b * x) + c

final_h = 0.021921776098478264
steps = [0.0002850255779418588, 0.00030963455522791273, 0.00024744073793901006, 0.00014650343597047335, 0.00017867955190232349, 0.00021616101934106985, 0.0001711240570153906, 0.00013542579373847057, 0.00013117885716768755, 0.0001473374096350403, 0.00016970850884594733, 0.00014635570197790975, 0.0001403769206922154, 0.00013497250495850786, 0.00013950008479837218, 0.00014055866123484275, 0.00013234830081327014, 0.00011444232482852451, 0.00011579325283758192, 0.00011299021107273946, 0.00010609403136166776, 0.00010134843779554051, 9.745170379466504e-05, 9.904914285972961e-05, 0.00010326961094664008, 0.00010068017582252724, 9.873462823360712e-05, 0.0001014633373287565, 0.00010004141482125237, 0.00010195813942170083, 9.804830392542117e-05, 9.64190135902699e-05, 9.249738666516037e-05, 9.32221495363976e-05, 8.862019663178136e-05, 8.852196127851278e-05, 8.38981750901132e-05, 8.466550366396756e-05, 8.18276082662963e-05, 8.094135265925007e-05, 8.331584084673993e-05, 8.11058649620236e-05, 7.919336302617853e-05, 7.751316936984408e-05, 7.820221950838487e-05, 7.893306354247315e-05, 8.076817830525267e-05, 7.901461013768048e-05, 8.178500828154647e-05, 8.111775638677127e-05, 7.919541213726594e-05, 7.991409926170687e-05, 8.100431769271325e-05, 7.83176065436951e-05, 7.993394505917753e-05, 7.986572174036206e-05, 7.962800455544629e-05, 7.83469215045289e-05, 7.743972000879944e-05, 7.74564864419354e-05, 7.559895895385867e-05, 7.535809296691648e-05, 7.46277515921677e-05, 7.541514882893237e-05, 7.300035433225639e-05, 7.294739647379159e-05, 7.156771145770506e-05, 7.16587832882195e-05, 7.135889344557673e-05, 7.054693779846334e-05, 6.945287485567858e-05, 6.821110828229664e-05, 6.675877088008729e-05, 6.614196840778672e-05, 6.503532725611431e-05, 6.46860672939651e-05, 6.420429367803848e-05, 6.306831828586067e-05, 6.287939995707446e-05, 6.2195899203768e-05, 6.281351662651598e-05, 6.221378904827483e-05, 6.132173494387272e-05, 6.031549450243902e-05, 5.9891775991886484e-05, 6.0198911930398405e-05, 5.999290106427704e-05, 5.9976404798907715e-05, 5.97667447511923e-05, 5.933135348048374e-05, 5.833036091553931e-05, 5.812039973612272e-05, 5.8110160471951805e-05, 5.8158064827574726e-05, 5.778935063435742e-05, 5.753254175469742e-05, 5.7072832508558644e-05, 5.655778187516232e-05, 5.615970474283534e-05, 5.59605131850386e-05, 5.569551361871844e-05, 5.5154178857888536e-05, 5.485944532727417e-05, 5.481832569851838e-05, 5.397134576486454e-05, 5.3566057411112006e-05, 5.358390477957012e-05, 5.372461795922871e-05, 5.357034978663126e-05, 5.369012776645053e-05, 5.370775103866535e-05, 5.3419248590284504e-05, 5.381925789762522e-05, 5.333083313660385e-05, 5.310384989258045e-05, 5.279763055216456e-05, 5.229531339227475e-05, 5.210413029544357e-05, 5.1919518399865666e-05, 5.10755344016664e-05, 5.107258409044364e-05, 5.083448985504849e-05, 5.042015448775486e-05, 5.0143838907898766e-05, 5.000399571845893e-05, 4.928878369126616e-05, 4.931745690044467e-05, 4.8815391242691686e-05, 4.9001430543666596e-05, 4.8823095837825445e-05, 4.8786363116115616e-05, 4.8599292004555816e-05, 4.8415838187754884e-05, 4.81658755075616e-05, 4.829968305011985e-05, 4.8209441637062436e-05, 4.7833441865296686e-05, 4.754344463706907e-05, 4.795033864983707e-05, 4.774543228929298e-05, 4.784832435681882e-05, 4.794374030316767e-05, 4.7843175296529566e-05, 4.736531427807292e-05, 4.737019506394907e-05, 4.708927219535322e-05, 4.672252103736507e-05, 4.647443168253468e-05, 4.626755904259608e-05, 4.630432284261771e-05, 4.603923807177529e-05, 4.5975997893236975e-05, 4.566345569010852e-05, 4.5546406725129746e-05, 4.5568558506330764e-05, 4.6019848928914586e-05, 4.596044528037621e-05, 4.5968321384537436e-05, 4.601634843065874e-05, 4.593645379292674e-05, 4.616759212310029e-05, 4.602630022157092e-05, 4.602824419961543e-05, 4.61452169238305e-05, 4.5932548888807934e-05, 4.591763248756181e-05, 4.578466671364273e-05, 4.565721324622726e-05, 4.538898969692895e-05, 4.5348626969164696e-05, 4.5234634134465324e-05, 4.5128301684561195e-05, 4.4875993763401206e-05, 4.4825518972332196e-05, 4.4551982075008434e-05, 4.4508021270033005e-05, 4.439179837831958e-05, 4.4300001833336156e-05, 4.430357840999252e-05, 4.432424135533686e-05, 4.432476618508249e-05, 4.417298934140251e-05, 4.4261632381158156e-05, 4.403897635962481e-05, 4.393906117879445e-05, 4.380529019725604e-05, 4.36774504424392e-05, 4.336109430071872e-05, 4.343731388364164e-05, 4.3366443223738504e-05, 4.325132232793974e-05, 4.3250614759095946e-05, 4.297042862043757e-05, 4.2768238231297856e-05, 4.2747405279611184e-05, 4.268865996755189e-05, 4.2404832039582424e-05, 4.2355376108627746e-05, 4.22446211020798e-05, 4.218057607498216e-05, 4.211559973603743e-05, 4.186728570437434e-05, 4.164242567987128e-05, 4.144474412700119e-05, 4.116806958077979e-05, 4.1138238323371046e-05, 4.098470909493293e-05, 4.0729231012281986e-05, 4.0806694329379584e-05, 4.0525414451385994e-05, 4.033953365711884e-05, 4.0076231462984196e-05, 3.996597460917406e-05, 3.968522619391887e-05, 3.945371251212401e-05, 3.946478281939905e-05, 3.934862429592553e-05, 3.920020394027751e-05, 3.907461332750342e-05, 3.897581072436623e-05, 3.8889933961162165e-05, 3.861829718135312e-05, 3.837318580798485e-05, 3.812780187156112e-05, 3.8075809459497956e-05, 3.796377545276994e-05, 3.7775240946051614e-05, 3.7680635817435165e-05, 3.757149727211251e-05, 3.740377638997844e-05, 3.729180200294155e-05, 3.730099616493232e-05, 3.73493535972616e-05, 3.7279838863275155e-05, 3.7281264267542e-05, 3.715519360958722e-05, 3.702560761971799e-05, 3.681338597351369e-05, 3.674421521779672e-05, 3.6646299715371866e-05, 3.653449516407767e-05, 3.6220286429706344e-05, 3.620284266427076e-05, 3.603780963343933e-05, 3.5902892898679456e-05, 3.573764879332558e-05, 3.5640511477787185e-05, 3.560205364110808e-05, 3.557055077093793e-05, 3.5532843727738295e-05, 3.5492596185057734e-05, 3.548739056876554e-05, 3.54143264000642e-05, 3.5348480585145614e-05, 3.531979975129537e-05, 3.5259456486445157e-05, 3.514411587896352e-05, 3.5054815593842104e-05, 3.492786797078262e-05, 3.471343742580263e-05, 3.469215261009753e-05, 3.458616231118844e-05, 3.454925615144211e-05, 3.4520652032136306e-05, 3.4347788196813916e-05, 3.431715498605076e-05, 3.422826865956061e-05, 3.4169997547007364e-05, 3.410781524191067e-05, 3.3953737198919726e-05, 3.397068779827095e-05, 3.390554848314159e-05, 3.387483488194107e-05, 3.380042384877255e-05, 3.3714290429052995e-05, 3.36447400436056e-05, 3.3602365715409976e-05, 3.3655962043153964e-05, 3.3596734453973653e-05, 3.354815079683465e-05, 3.351109222756235e-05, 3.341376924216252e-05, 3.335718445081348e-05, 3.3301766849892084e-05, 3.3272121841110974e-05, 3.323408396083832e-05, 3.310286864299447e-05, 3.30246917366675e-05, 3.30290555384527e-05, 3.297802383986706e-05, 3.284441209034511e-05, 3.2820364672760116e-05, 3.2783372584534176e-05, 3.275953297453629e-05, 3.261262728711592e-05, 3.260695756939283e-05, 3.243129729303684e-05, 3.2337801751613354e-05, 3.232998979413662e-05, 3.2287446440220496e-05, 3.225277652316519e-05]
n = len(steps)
time = np.arange(0,n)

# Regression 
popt, pcov = curve_fit(func, time, steps)
x_plot=np.linspace(0,n,500)

# Equation
a=popt[0].round(6)
b=popt[1].round(6)
c=popt[2].round(6)
eqn = f'y={a}e^({b}x)+{c}'
print(f'The equation of regression line is y={a}e^({b}x)+{c}')

plt.scatter(time, steps)
plt.plot(x_plot, func(x_plot, *popt), 'r-')
plt.title("Change in Height of Liquid Front in Segment Case Time Simulation")
plt.ylabel("Change in Position of Liquid Front (m)")
plt.xlabel("Time Step")
plt.legend([eqn, "Change in Height"])
plt.show()
